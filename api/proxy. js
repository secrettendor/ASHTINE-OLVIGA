export default async function handler(req, res) {
  try {
    const target = 'https://vpchoiceawards.com/powerpick/';
    const r = await fetch(target, { redirect: 'follow' });
    let html = await r.text();

    const injected = `
<script>
(function(){
  const name = (new URLSearchParams(location.search).get('q') || 'ASHTINE OLVIGA').toUpperCase();
  function highlight(targetEl){
    targetEl.scrollIntoView({behavior:'smooth', block:'center'});
    targetEl.style.outline = '4px solid gold';
    targetEl.style.backgroundColor = 'rgba(255,215,0,0.15)';
  }
  function findAndAct(){
    const walker = document.createTreeWalker(document.body, NodeFilter.SHOW_ELEMENT, null, false);
    let node;
    while(node = walker.nextNode()){
      try{
        if(node.textContent && node.textContent.toUpperCase().includes(name)){
          highlight(node);
          return true;
        }
      }catch(e){}
    }
    return false;
  }
  if(findAndAct()) return;
  const observer = new MutationObserver((mutations, obs)=>{
    if(findAndAct()) obs.disconnect();
  });
  observer.observe(document.documentElement || document.body, {childList:true, subtree:true});
})();
</script>
`;
    if (html.includes('</body>')) html = html.replace('</body>', injected + '</body>');
    else html += injected;

    res.setHeader('Content-Type', 'text/html; charset=utf-8');
    res.status(200).send(html);
  } catch (err) {
    res.status(500).send('Proxy error: ' + String(err));
  }
}

